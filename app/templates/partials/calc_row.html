<tr id="row-{{ row.id }}">
  <td>{{ row.id }}</td>
  <td>
    <form class="hidden" id="edit-form-{{ row.id }}" hx-post="/ui/calculations/{{ row.id }}" hx-target="#row-{{ row.id }}" hx-swap="outerHTML">
      <select name="operation">
        {% for op in ['add','subtract','multiply','divide'] %}
        <option value="{{ op }}" {% if row.operation.value==op %}selected{% endif %}>{{ op }}</option>
        {% endfor %}
      </select>
      <input name="a" type="number" step="any" value="{{ row.operands[0] }}" required />
      <input name="b" type="number" step="any" value="{{ row.operands[1] }}" required />
      <button type="submit">Save</button>
      <button type="button" onclick="toggleEdit({{ row.id }}, false)">Cancel</button>
    </form>
    <span id="view-op-{{ row.id }}">{{ row.operation.value }}</span>
  </td>
  <td><span id="view-ops-{{ row.id }}">{{ row.operands }}</span></td>
  <td>{{ '%.6g' % row.result if row.result is not none else '' }}</td>
  <td>{{ row.updated_at.strftime('%Y-%m-%d %H:%M:%S') if row.updated_at else '' }}</td>
  <td>
    <button onclick="toggleEdit({{ row.id }}, true)">Edit</button>
    <button hx-delete="/ui/calculations/{{ row.id }}" hx-target="#row-{{ row.id }}" hx-swap="outerHTML:remove">Delete</button>
  </td>
</tr>
<script>
function toggleEdit(id, editing) {
  const form = document.getElementById('edit-form-'+id);
  const op = document.getElementById('view-op-'+id);
  const ops = document.getElementById('view-ops-'+id);
  if (editing) { form.classList.remove('hidden'); op.classList.add('hidden'); ops.classList.add('hidden'); }
  else { form.classList.add('hidden'); op.classList.remove('hidden'); ops.classList.remove('hidden'); }
}
</script>
